@using Microsoft.IdentityModel.Tokens
@using SellIt.Core.ViewModels.Messages
@model IEnumerable<AllMessagesViewModel>

<!DOCTYPE html>
<html>
<head>
    <title>Conversation View</title>
    <style>
        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .product-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-photo {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }

        .message {
            background-color: #f2f2f2;
            padding: 10px;
            margin-bottom: 20px;
        }

        .message .user {
            font-weight: bold;
        }

        .message .date {
            color: #888;
            font-size: 12px;
        }

        .message .message-body p {
            margin: 0;
        }

        .reply {
            background-color: #e6e6e6;
            padding: 10px;
            margin-top: 10px;
        }

        .reply .user {
            font-weight: bold;
        }

        .reply .date {
            color: #888;
            font-size: 12px;
        }

        .reply .reply-body p {
            margin: 0;
        }

        .message-separator {
            border-top: 1px solid #ccc;
            margin-top: 20px;
        }

        .product-separator {
            border-top: 2px solid #333;
            margin-top: 40px;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        @{
            var prevProductName = "";
            var counter = 0;
        }

        @foreach (var message in Model)
        {
            if (message.ProductName != prevProductName && counter > 0)
            {
                <div class="product-separator"></div>
            }

            <h2 class="product-name">Product: @message.ProductName</h2>

            <a asp-action="GetProductById" asp-controller="Product" class="btn" asp-route-id="@message.ProductId">
                        <img class="product-photo" src="@message.Photo">
                    </a>

            @*<img class="product-photo" src="@message.Photo" alt="Product Photo">*@

            <div class="message">
                <div class="message-header">
                    <span class="user">@message.UserName</span>
                    <span class="date">@message.Date.ToString("yyyy-MM-dd")</span>
                </div>
                <div class="message-body">
                    <p>@message.Text</p>
                </div>
            </div>

            <div class="reply-messages">
                @foreach (var reply in message.ReplyMessages)
                {
                    <div class="reply">
                        <div class="reply-header">
                            <span class="user">@reply.ReplyerUserName</span>
                            <span class="date">@reply.ReplyerDate.ToString("yyyy-MM-dd")</span>
                        </div>
                        <div class="reply-body">
                            <p>@reply.ReplyText</p>
                        </div>
                    </div>
                }
            </div>

            prevProductName = message.ProductName;
            counter++;
        }
    </div>
</body>
</html>


