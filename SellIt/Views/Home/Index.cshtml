@using SellIt.Core.Constants
@using SellIt.Core.ViewModels.Home
@using SellIt.Core.ViewModels.Product
@model HomeViewModel

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Boutique | Ecommerce bootstrap template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- gLightbox gallery-->
    <link rel="stylesheet" href="/vendor/glightbox/css/glightbox.min.css">
    <!-- Range slider-->
    <link rel="stylesheet" href="/vendor/nouislider/nouislider.min.css">
    <!-- Choices CSS-->
    <link rel="stylesheet" href="/vendor/choices.js/public/assets/styles/choices.min.css">
    <!-- Swiper slider-->
    <link rel="stylesheet" href="/vendor/swiper/swiper-bundle.min.css">
    <!-- Google fonts-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Martel+Sans:wght@300;400;800&amp;display=swap">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="/img/favicon.png">
</head>
<body>
    <div class="page-holder">
        <div class="container">
            <!-- HERO SECTION-->
            <section class="hero pb-3 bg-cover bg-center d-flex align-items-center" width=100px style="background: url(img/hero-banner-alt.jpg)">
                <div class="container py-5">
                    <div class="row px-4 px-lg-5">
                        <div class="row">
                            <p class="text-muted small text-uppercase mb-2"></p>
                             <ul class="navbar-nav me-auto">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <li class="nav-item">
                                    <!-- Link--><a class="nav-link active" asp-action="Favorites" asp-controller="Product">Favorites</a>
                                </li>
                                <li class="nav-item">
                                    <!-- Link--><a class="nav-link" asp-action="MyProducts" asp-controller="Product"> My products</a>
                                </li>
                                <li class="nav-item">
                                    <!-- Link--><a class="nav-link" asp-action="AddProduct" asp-controller="Product">Add a product</a>
                                </li>
                            }
                        </ul>
                        </div>
                    </div>
                </div>
            </section>
            <section class="py-5">
                <div class="container p-0">
                    <div class="row">
                        <!-- SHOP LISTING-->
                        <div class="col-lg-9 order-1 order-lg-2 mb-5 mb-lg-0">
                            <section class="pt-5">
                                <header class="text-center">
                                    <p class="small text-muted small text-uppercase mb-1">Carefully created collections</p>
                                    <h2 class="h5 text-uppercase mb-4">Browse our categories</h2>
                                </header>
                                <div class="row" method="post" enctype="multipart/form-data">
                                    @foreach (var category in (IEnumerable<AddEditProductViewModel>)this.ViewData["categories"])
                                    {
                                        <div class="col-md-4">
                                            <a class="category-item" asp-action="AllProductsByCategoryId" asp-controller="Product" asp-route-id=@category.CategoryId>
                                                <img class="img-fluid" src="@category.CategoryImage" alt="" /><strong class="category-item-title">@category.CategoryName</strong>
                                            </a>
                                        </div>
                                    }
                                </div>
                            </section>
                            <header>
                                <p class="small text-muted small text-uppercase mb-1">Made the hard way</p>
                                <h2 class="h5 text-uppercase mb-4">Top trending products</h2>
                            </header>
                            <div class="row">
                                <!-- PRODUCT-->
                                @foreach (var item in Model.RandomProducts)
                                {
                                    <div class="col-lg-4 col-sm-6">
                                        <div class="product text-center">
                                            <div class="mb-3 position-relative">
                                                <div class="badge text-white bg-"></div><a class="d-block" asp-action="GetProductById" asp-controller="Product" asp-route-id="@item.Id">
                                                    <img class="img-fluid w-100" src="@item.CoverPhoto" alt="@item.Name">
                                                </a>
                                            </div>
                                            <h6> <a class="reset-anchor">@item.Name</a></h6>
                                            <p class="small text-muted">$@item.Price</p>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
            </section>
        </div>
        <footer class="bg-dark text-white">
            <div class="container py-4">
                <div class="row py-5">
                    <div class="col-md-4 mb-3 mb-md-0">
                        <h6 class="text-uppercase mb-3">Customer services</h6>
                        <ul class="list-unstyled mb-0">
                            <li><a class="footer-link" href="#!">Help &amp; Contact Us</a></li>
                            <li><a class="footer-link" href="#!">Returns &amp; Refunds</a></li>
                            <li><a class="footer-link" href="#!">Online Stores</a></li>
                            <li><a class="footer-link" href="#!">Terms &amp; Conditions</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4 mb-3 mb-md-0">
                        <h6 class="text-uppercase mb-3">Company</h6>
                        <ul class="list-unstyled mb-0">
                            <li><a class="footer-link" href="#!">What We Do</a></li>
                            <li><a class="footer-link" href="#!">Available Services</a></li>
                            <li><a class="footer-link" href="#!">Latest Posts</a></li>
                            <li><a class="footer-link" href="#!">FAQs</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-uppercase mb-3">Social media</h6>
                        <ul class="list-unstyled mb-0">
                            <li><a class="footer-link" href="#!">Twitter</a></li>
                            <li><a class="footer-link" href="#!">Instagram</a></li>
                            <li><a class="footer-link" href="#!">Tumblr</a></li>
                            <li><a class="footer-link" href="#!">Pinterest</a></li>
                        </ul>
                    </div>
                </div>
                <div class="border-top pt-4" style="border-color: #1d1d1d !important">
                    <div class="row">
                        <div class="col-md-6 text-center text-md-start">
                            <p class="small text-muted mb-0">&copy; 2021 All rights reserved.</p>
                        </div>
                        <div class="col-md-6 text-center text-md-end">
                            <p class="small text-muted mb-0">Template designed by <a class="text-white reset-anchor" href="https://bootstrapious.com/p/boutique-bootstrap-e-commerce-template">Bootstrapious</a></p>
                            <!-- If you want to remove the backlink, please purchase the Attribution-Free License. See details in readme.txt or license.txt. Thanks!-->
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- JavaScript files-->
        <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="/vendor/nouislider/nouislider.min.js"></script>
        <script src="/vendor/swiper/swiper-bundle.min.js"></script>
        <script src="/vendor/choices.js/public/assets/scripts/choices.min.js"></script>
        <script src="/js/front.js"></script>
        <!-- Nouislider Config-->
        <script>
            var range = document.getElementById('range');
            noUiSlider.create(range, {
                range: {
                    'min': 0,
                    'max': 2000
                },
                step: 5,
                start: [100, 1000],
                margin: 300,
                connect: true,
                direction: 'ltr',
                orientation: 'horizontal',
                behaviour: 'tap-drag',
                tooltips: true,
                format: {
                    to: function(value) {
                        return '$' + value;
                    },
                    from: function(value) {
                        return value.replace('', '');
                    }
                }
            });

        </script>
        <script>
            // ------------------------------------------------------- //
            //   Inject SVG Sprite -
            //   see more here
            //   https://css-tricks.com/ajaxing-svg-sprite/
            // ------------------------------------------------------ //
            function injectSvgSprite(path) {

                var ajax = new XMLHttpRequest();
                ajax.open("GET", path, true);
                ajax.send();
                ajax.onload = function(e) {
                    var div = document.createElement("div");
                    div.className = 'd-none';
                    div.innerHTML = ajax.responseText;
                    document.body.insertBefore(div, document.body.childNodes[0]);
                }
            }
            // this is set to BootstrapTemple website as you cannot
            // inject local SVG sprite (using only 'icons/orion-svg-sprite.svg' path)
            // while using file:// protocol
            // pls don't forget to change to your domain :)
            injectSvgSprite('https://bootstraptemple.com/files/icons/orion-svg-sprite.svg');

        </script>
        <!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    </div>
</body>
</html>


<div id="contentContainer"></div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let likedElement = $("#liked");
    let likeButton = $("#likeButton");
    let modelId = @Model.Id;
    let modelCount = @Model.LikedCount;

    likeButton.on("click", function(event) {
        event.preventDefault();

        let currentLikedCount = parseInt(likedElement.text());
        let newLikedCount = currentLikedCount + 1;

        $.ajax({
            url: `/Product/Like?id=${modelId}`,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ likedCount: newLikedCount }),
            success: function(response) {
                location.reload();
            },
            error: function(xhr, status, error) {
                console.log("An error occurred:", error);
            }
        });
    });
</script>

<script>
    $(document).ready(function() {
        var products = @Html.Raw(Json.Serialize(Model.RandomProducts));
        var totalPages = Math.ceil(products.length / 1); // Set the number of items per page here

        function displayProducts(page) {
            var startIndex = (page - 1) * 1; // Set the number of items per page here
            var endIndex = startIndex + 1; // Set the number of items per page here

            // Clear the existing products
            $("#productContainer").empty();

            // Display the products for the current page
            for (var i = startIndex; i < endIndex; i++) {
                if (i < products.length) {
                    var product = products[i];
                    var productHtml = `
                                                        <div class="col-lg-4 col-sm-6">
                                                            <div class="product text-center">
                                                                <div class="mb-3 position-relative">
                                                                    <div class="badge text-white bg-"></div>
                                                                    <a class="d-block" asp-action="GetProductById" asp-controller="Product" class="btn" asp-route-id="${product.Id}">
                                                                        <img class="img-fluid w-100" src="${product.CoverPhoto}" alt="${product.Name}">
                                                                    </a>
                                                                </div>
                                                                <h6><a class="reset-anchor" href="detail.html">${product.Name}</a></h6>
                                                                <p class="small text-muted">$${product.Price}</p>
                                                            </div>
                                                        </div>
                                                    `;

                    $("#productContainer").append(productHtml);
                }
            }
        }

        // Initialize the pagination
        displayProducts(1);

        // Handle previous page click
        $("#previousPage").click(function(event) {
            event.preventDefault();

            var currentPage = parseInt($("#currentPage").text());
            if (currentPage > 1) {
                displayProducts(currentPage - 1);
                $("#currentPage").text(currentPage - 1);
            }
        });

        // Handle next page click
        $("#nextPage").click(function(event) {
            event.preventDefault();

            var currentPage = parseInt($("#currentPage").text());
            if (currentPage < totalPages) {
                displayProducts(currentPage + 1);
                $("#currentPage").text(currentPage + 1);
            }
        });
    });
</script>